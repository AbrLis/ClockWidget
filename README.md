# ClockWidgetApp

## Описание
ClockWidgetApp — виджет часов для Windows, реализованный на WPF с поддержкой цифровых и аналоговых часов, гибкой настройкой внешнего вида, звуковыми сигналами, будильниками и таймерами, а также полной поддержкой локализации (русский и английский языки).

## Основные возможности
- Цифровые и аналоговые часы (отображаются независимо)
- **Будильники и таймеры**: добавление, редактирование, удаление, уведомления и звуковые сигналы
- Настройка прозрачности фона и текста
- Изменяемый размер шрифта и аналоговых часов
- Звуковые сигналы: кукушка каждый час, сигнал каждые полчаса (опционально)
- Настройка поверх всех окон
- Сохранение и загрузка всех настроек
- Локализация интерфейса (русский, английский; легко добавить новые языки)
- Трей-меню для быстрого доступа к функциям
- Современная архитектура MVVM, DI (Dependency Injection)
- **Длинные таймеры**: установка таймеров на произвольную дату и время (например, на несколько дней или недель вперёд), уведомления, сохранение, локализованные тултипы (сохраняются между перезапусками)

## Будильники и таймеры
- Вкладка "Будильники и таймеры" в окне настроек
- Можно создавать несколько таймеров и будильников
- Для каждого таймера/будильника доступны: запуск, остановка, удаление
- По срабатыванию таймера или будильника появляется всплывающее окно с уведомлением и проигрывается соответствующий звук
- Все таймеры и будильники сохраняются между запусками приложения 

## Длинные таймеры
Длинные таймеры позволяют создавать напоминания на произвольную дату и время (например, через несколько дней, недель или месяцев). Это удобно для редких событий, встреч, дедлайнов и т.д.

- Добавление длинного таймера через вкладку "Будильники и таймеры" в окне настроек
- Для каждого длинного таймера можно указать имя и точное время срабатывания
- По срабатыванию появляется отдельное уведомление и проигрывается специальный звук
- Все длинные таймеры сохраняются между запусками приложения
- Для каждого длинного таймера отображается тултип (в окне настроек и в трее):
  - В окне настроек: имя и время, на которое установлен таймер
  - В трее: имя, время срабатывания и оставшееся время (всё локализовано)
- Полная поддержка локализации (русский, английский)

## Сборка и запуск

### Требования
- .NET 9.0 SDK (для сборки проекта. exe файл в релизе не требует установки NET, все зависимости уже включены)
- Windows 10/11

### Сборка
```sh
dotnet build
```

### Запуск
```sh
dotnet run --project ClockWidgetApp/ClockWidgetApp.csproj
```
## Структура проекта

- `ClockWidgetApp/`
  - `ViewModels/` — ViewModel для окон, элементов и бизнес-логики приложения
  - `Models/` — модели данных и настроек
  - `Helpers/` — вспомогательные классы, конвертеры, менеджер локализации
  - `Views/` — XAML и code-behind окон и диалогов
  - `Services/` — DI-сервисы, бизнес-логика, взаимодействие с ОС
  - `Resources/` — иконки, звуки, строки локализации
  - Прочие инфраструктурные файлы приложения
- `CleanTest/` — модульные тесты (xUnit) для ViewModel, сервисов, бизнес-логики, сериализации и валидации

## Локализация
- Все строки UI вынесены в `.resx`-файлы (`StringsEng.resx`, `StringsRus.resx`)
- Менеджер локализации (`Helpers/LocalizationManager.cs`) централизует доступ к строкам и управляет языком
- Смена языка происходит мгновенно во всех окнах через событие `LanguageChanged`
- Для добавления нового языка:
  1. Создайте новый `.resx`-файл в `Resources/Localization/` (например, `StringsDe.resx`)
  2. Добавьте обработку нового языка в `LocalizationManager`
  3. Добавьте ключи и переводы

## Настройки
- Все настройки пользователя хранятся в JSON (`widget_settings.json` в AppData)
- Настройки буферизуются и сохраняются при выходе из приложения
- Язык, внешний вид, поведение часов, звуковые сигналы, будильники и таймеры — всё настраивается через окно настроек
- Будильники и таймеры сохраняются автоматически

## Архитектура
- **MVVM**: разделение логики, UI и данных
- **Dependency Injection**: все сервисы и ViewModel регистрируются через DI-контейнер
- **Ресурсы**: все строки, иконки, звуки вынесены в ресурсы
- **Локализация**: централизовано через `LocalizationManager`

## Как добавить новую строку для локализации
1. Добавьте ключ и перевод в оба `.resx`-файла
2. Добавьте свойство в `LocalizedStrings` (если нужно биндингом в XAML)
3. Используйте через биндинг или через `LocalizationManager.GetString("Key")`


## Включение и настройка логирования
- Для управления уровнем логирования используйте флаг командной строки `--log-level=LEVEL` при запуске приложения.
- Доступные уровни: `TRACE`, `DEBUG`, `INFO`, `WARNING`, `ERROR`, `FATAL`
- Примеры:

```sh
# Включить отладочные сообщения
ClockWidgetApp.exe --log-level=DEBUG

# Только ошибки
ClockWidgetApp.exe --log-level=ERROR

# Для dotnet run:
dotnet run --project ClockWidgetApp/ClockWidgetApp.csproj -- --log-level=INFO
```

- По умолчанию используется уровень WARNING.
- Все логи пишутся в файл:
  - `%APPDATA%/ClockWidget/logs/clock-widget-<дата>.log`

---

## Тестирование

### Как запустить тесты

- Вариант 1 (универсальный):
  ```sh
  dotnet test CleanTest/CleanTest.csproj --logger "console;verbosity=normal"
  ```
- Вариант 2 (Windows, PowerShell):
  ```sh
  ./run-tests.ps1
  ```

### Что покрыто тестами
- Бизнес-логика ViewModel (таймеры, будильники, длинные таймеры)
- Сервисы: сохранение/загрузка настроек, сериализация/десериализация таймеров и будильников
- Валидация времени, граничные и ошибочные случаи
- Проверка невозможности добавления дубликатов
- Обработка повреждённых/пустых файлов
- Буферизация и обновление настроек

> **Важно:** Интеграция с WPF (UI, Application.Current, DI-контейнер) не покрывается юнит-тестами и требует отдельного интеграционного тестирования.

---

## Вклад
PR и предложения приветствуются! Пишите баги и пожелания в Issues.

## Лицензия
MIT License