# Clock Widget App

## Описание
Clock Widget App — это десктопное приложение-виджет для Windows, отображающее текущее время в виде полупрозрачного оверлея на рабочем столе. Приложение позволяет настраивать внешний вид и поведение виджета через удобный интерфейс настроек.

## Основные возможности
- Отображение текущего времени в двух режимах:
  - Аналоговые часы с настраиваемым размером и стилем
  - Цифровые часы в формате ЧЧ:ММ:СС
- Настраиваемая прозрачность фона и текста
- Регулируемый размер шрифта для цифровых часов
- Настраиваемый размер аналоговых часов
- Возможность включения/отключения отображения секунд
- Сохранение пользовательских настроек между запусками (буферизация настроек — изменения применяются в памяти, запись на диск только при завершении приложения)
- Возможность перемещения виджетов по рабочему столу
- Независимое позиционирование аналоговых и цифровых часов
- Воспроизведение звуковых сигналов (опционально)

## Архитектура и технологии
- **MVVM**: ViewModel содержит только логику представления и работает через сервисы.
- **Services**: Реализуют бизнес-логику и работу с внешними ресурсами. Все сервисы реализуют интерфейсы (`ISettingsService`, `ITimeService`, `ISoundService`).
- **Helpers**: Утилиты и константы, не зависящие от состояния приложения.
- **Models**: Только структуры данных, без бизнес-логики.
- **Dependency Injection**: Все зависимости (ViewModel, сервисы, логгеры) внедряются через DI-контейнер (Microsoft.Extensions.DependencyInjection). Окна и ViewModel получают зависимости через конструктор.
- **Логирование**: Используется Serilog через Microsoft.Extensions.Logging.

## Структура проекта
```
ClockWidgetApp/              # Корневая директория
├── ClockWidgetApp.sln      # Файл решения
├── README.md               # Документация
├── run.ps1                 # Скрипт запуска
├── run-debug.ps1           # Скрипт запуска с отладкой
├── build.ps1               # Скрипт сборки
├── publish-release.ps1     # Скрипт публикации релиза
└── ClockWidgetApp/         # Директория проекта
    ├── Models/             # Модели данных и классы настроек
    │   ├── WidgetSettings.cs      # Настройки виджета
    │   └── ClockTick.cs           # Модель тика часов
    ├── ViewModels/         # Модели представления (MVVM)
    │   ├── MainWindowViewModel.cs                # Основная модель представления
    │   ├── MainWindowViewModel.Properties.cs     # Свойства основной модели
    │   ├── MainWindowViewModel.Settings.cs       # Работа с настройками
    │   ├── MainWindowViewModel.Windows.cs        # Работа с окнами
    │   ├── AnalogClockViewModel.cs               # Модель аналоговых часов
    │   ├── SettingsWindowViewModel.cs            # Модель окна настроек
    │   └── ISettingsViewModel.cs                 # Интерфейс для ViewModel настроек
    ├── Views/                # Представления (XAML)
    │   ├── MainWindow.xaml           # Главное окно
    │   ├── MainWindow.xaml.cs        # Логика главного окна
    │   ├── AnalogClockWindow.xaml    # Окно аналоговых часов
    │   ├── AnalogClockWindow.xaml.cs # Логика окна аналоговых часов
    │   ├── SettingsWindow.xaml       # Окно настроек
    │   └── SettingsWindow.xaml.cs    # Логика окна настроек
    ├── Services/             # Сервисы и их интерфейсы
    │   ├── ISettingsService.cs       # Интерфейс сервиса настроек
    │   ├── SettingsService.cs        # Сервис настроек
    │   ├── ITimeService.cs           # Интерфейс сервиса времени
    │   ├── TimeService.cs            # Сервис времени
    │   ├── ISoundService.cs          # Интерфейс сервиса звуков
    │   └── SoundService.cs           # Сервис звуков
    ├── Helpers/              # Вспомогательные классы
    │   ├── Constants.cs                # Константы приложения
    │   ├── AnalogClockConstants.cs     # Константы аналоговых часов
    │   ├── WindowPositionHelper.cs     # Помощник позиционирования окон
    │   └── CenterDotPositionConverter.cs # Конвертер для центра аналоговых часов
    ├── Resources/            # Ресурсы приложения
    │   ├── Icons/                    # Иконки приложения
    │   │   ├── app.ico
    │   │   ├── app_ico_16.ico
    │   │   ├── app_ico_32.ico
    │   │   ├── app_ico_64.ico
    │   │   ├── app_ico_128.ico
    │   │   └── app_ico_256.ico
    │   └── Sounds/                   # Звуковые файлы для сигналов
    │       ├── 1.mp3 ... 12.mp3
    ├── App.xaml                # Точка входа приложения (XAML)
    ├── App.xaml.cs             # Логика приложения, инициализация DI
    └── AssemblyInfo.cs         # Информация о сборке
```

## Запуск проекта

### Через командную строку
Из корневой директории проекта:
```bash
# Используя скрипт
.\run.ps1

# Или напрямую
dotnet run --project ClockWidgetApp
```

## Сборка проекта со всеми зависимостями в один файл
Для сборки проекта в релиз достаточно запустить скрипт `publish-release.ps1` из корневой директории:
```bash
.\publish-release.ps1
```

Скрипт выполнит очистку предыдущих сборок, соберет проект и удалит лишние файлы, оставив только папку `publish` с итоговым билдом.

Файл будет находиться в папке `bin/Release/`

## Работа с настройками
- Все изменения настроек происходят только в памяти (буфер), а сохранение на диск выполняется только при закрытии приложения.
- ViewModel используют только буферизированные значения, а не прямое сохранение.
- Файл настроек приложения (`settings.json`) хранится в `%APPDATA%\ClockWidget\`

## Логирование

Приложение использует Serilog через Microsoft.Extensions.Logging. Все логи записываются в файл:
```
%APPDATA%\ClockWidget\logs\clock-widget-<дата>.log
```

### Настройка уровня логирования

Уровень логирования можно задать через флаг командной строки `--log-level=LEVEL` при запуске приложения:

```powershell
# Включить отладочные сообщения
.\ClockWidgetApp.exe --log-level=DEBUG

# Или только ошибки
.\ClockWidgetApp.exe --log-level=ERROR

# Для dotnet run:
dotnet run --project ClockWidgetApp -- --log-level=INFO
```

Доступные уровни: `TRACE`, `DEBUG`, `INFO`, `WARNING`, `ERROR`, `FATAL`

- Если флаг не задан, используется уровень WARNING по умолчанию.
- Все логи пишутся только в файл, интеграция с Microsoft.Extensions.Logging осуществляется через Serilog.

## Лицензия
MIT License
